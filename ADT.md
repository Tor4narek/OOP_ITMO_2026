# Типы данных, структуры данных и абстрактные типы данных

### Подход к проектированию и управлению сложной логикой


## Введение

Любое программное обеспечение работает с данными. Программа:

* получает данные,
* хранит данные,
* обрабатывает данные,
* изменяет состояние системы на основе результатов вычислений.

По мере роста сложности системы увеличивается количество:

* сущностей,
* параметров,
* зависимостей,
* условий и вычислений.

Если не выделить чётко роли данных и логику управления ими, код быстро превращается в трудно поддерживаемую и плохо расширяемую систему.

Цель данной лекции — показать подход, который позволяет:

* **осмысленно выделять данные**,
* **управлять сложной логикой**,
* **минимизировать связанность компонентов**.


# ЧАСТЬ 1. ТИП ДАННЫХ

## Базовые определения

**Информация** — сведения независимо от формы представления.

**Данные** — зарегистрированная информация.

**Вычисление** — получение нового знания из входных данных.

**Состояние** — набор переменных характеристик объекта, сохраняющихся до выполнения действия.

**Действие** — изменение состояния без изменения самих данных.


## Объекты реального мира и данные

Любой объект окружающего мира можно представить как комбинацию:

* **Сущность** — материальная или нематериальная вещь (например, автомобиль, документ, студент).
* **Параметры** — свойства объекта (масса, координаты, скорость, срок действия, оценки).
* **Действия** — операции, которые объект может совершать сам или которые можно применить к объекту извне (переместить автомобиль, выдать документ, вычислить средний балл).

Объект и его параметры неразделимы: они образуют **совокупность данных**, тогда как действие — необязательная характеристика.

### Примеры

* Яблоко → цвет, вкус, вес
* Автомобиль → масса, мощность, координаты
* Документ → номер, срок действия, тип


## Тип данных

### Определение

**Тип данных (ТД)** — атомарная, неделимая единица данных, определяемая пользователем, представляющая совокупность объекта реального мира и его параметров.

Тип данных:

* описывает состояние,
* хранит данные,
* выполняет вычисления только над своими данными,
* **не управляет действиями**.

### Тип данных в программировании

В ООП тип данных представлен **классом**:

* поля → данные;
* класс → пользовательский тип данных.

В СУБД:

* таблица → тип данных;
* строка → экземпляр данных.


## Правила выделения типа данных

1. Тип данных — реальная сущность, имя существительное.
2. Минимально достаточный набор параметров должен совпадать.
3. Разные наборы параметров → разные типы данных.

### Пример: квадрат и ромб

Обе фигуры являются частным случаем параллелограмма, но для квадрата достаточно одного параметра (длина стороны), а для ромба — двух (сторона и угол).

Это значит:

* квадрат и ромб — разные типы данных,
* в коде они должны быть представлены разными классами.

Можно определить общий **интерфейс `IParallelogram`** с методом `CalculateArea()`.

* **Полиморфизм** здесь проявляется в том, что квадрат и ромб реализуют один интерфейс, но вычисляют площадь по-разному.

```csharp
interface IParallelogram
{
    double CalculateArea();
}

class Square : IParallelogram
{
    public double Side { get; }
    public double CalculateArea() => Side * Side;
}

class Rhombus : IParallelogram
{
    public double Side { get; }
    public double Angle { get; }
    public double CalculateArea() => Side * Side * Math.Sin(Angle);
}
```

Полиморфизм позволяет **вызывать метод `CalculateArea()` для любого параллелограмма**, не проверяя конкретный тип фигуры.


## Требования к типу данных

* вычисления только со своими данными;
* отсутствие зависимости от внешнего состояния;
* неизменяемость данных на момент вычислений.

Это обеспечивает:

* предсказуемость;
* воспроизводимость;
* безопасность логики.


# ЧАСТЬ 2. СТРУКТУРЫ ДАННЫХ

## Что такое структура данных

**Структура данных** — способ организации, хранения и доступа к данным в памяти для эффективного выполнения операций над ними.

> Структура данных отвечает на вопрос: "Как именно хранятся и организуются данные?"


## Роль структур данных

Структура данных:

* не определяет, *что* это за данные;
* определяет, *как* они расположены и обрабатываются.

### Примеры структур данных

* массив;
* список;
* стек;
* очередь;
* словарь;
* дерево;
* граф.


## Тип данных и структура данных — различие

| Понятие          | Отвечает на вопрос |
| ---------------- | ------------------ |
| Тип данных       | Что это?           |
| Структура данных | Как это хранится?  |

**Пример**

Тип данных:

```text
Заказ
- Id
- Дата
- Сумма
```

Структуры данных для хранения заказов:

* `List<Order>`
* `Dictionary<Guid, Order>`
* `Queue<Order>`


## Структуры данных в контексте АТД

Структуры данных — **внутренний механизм** абстрактного типа данных.

АТД выбирает структуру данных исходя из задач:

* быстрый поиск;
* упорядочивание;
* обработка по времени;
* ограничение доступа.


# ЧАСТЬ 3. АБСТРАКТНЫЙ ТИП ДАННЫХ

## Определение АТД (по С. Макконнеллу)

> **Абстрактный тип данных** — это набор данных и операций над ними, служащих одной цели
> (С. Макконнелл, *«Совершенный код»*, глава 6.1).

В данном подходе:

* данные — наборы типов данных;
* операции — действия и вычисления над ними;
* структура данных — способ хранения этих наборов.


## Что делает АТД

Абстрактный тип данных:

* агрегирует данные;
* управляет состояниями;
* выполняет действия;
* скрывает внутренние структуры хранения.

АТД отвечает на вопрос:

> **Что можно сделать с этими данными?**


## Провайдеры данных

**Провайдер данных** — источник получения типов данных:

* файл;
* БД;
* API;
* пользовательский ввод.

АТД **не знает**, откуда пришли данные — он работает только с переданными наборами.


## Требования к АТД

1. Работает только со своими данными.
2. Не зависит от внешнего состояния.
3. Не получает данные самостоятельно.


## Примеры использования АТД

### Система заказов

Типы данных:

* Клиент
* Товар
* Заказ

Структуры данных:

* список заказов;
* словарь товаров.

АТД:

* рассчитывает стоимость;
* определяет статус;
* применяет бизнес-логику.

### Игра «Танки»

Типы данных:

* Танк
* Боеприпас
* Топливо
* Местность

Структуры данных:

* списки;
* карты;
* графы.

АТД:

* управляет боем;
* рассчитывает урон;
* фиксирует состояние мира.


## Преимущества подхода

* предсказуемость;
* масштабируемость;
* простота тестирования;
* слабая связанность;
* гибкость хранения данных.


## Итог лекции

* **Тип данных** — что мы храним.
* **Структура данных** — как мы это храним.
* **Абстрактный тип данных** — что мы с этим делаем.

Организация кода вокруг этих понятий:

* делает систему устойчивой к росту сложности;
* обеспечивает модульность;
* позволяет применять принципы ООП.

